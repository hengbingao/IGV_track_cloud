#!/usr/bin/env bash
set -e

# Get absolute path to src directory
script_dir="$(cd "$(dirname "${BASH_SOURCE[0]}")/../src" && pwd)"

show_help() {
    echo "IGV_cloud_tracks - Unified tool for cloud-based IGV visualization"
    echo
    echo "Usage:"
    echo "  IGV_cloud_tracks -dropbox_URL --key <access_token> --folder <dropbox_folder> [--output <output_file>]"
    echo "  IGV_cloud_tracks -igv_session_xml -i <input_file> [-o <output_file>] [-g <genome>]"
    echo
    echo "Subcommands:"
    echo "  -dropbox_URL         Generate Dropbox direct download URLs for all files in a folder"
    echo "  -igv_session_xml     Generate IGV session XML file from URL list"
    echo
    echo "Examples:"
    echo "  IGV_cloud_tracks -dropbox_URL --key YOUR_TOKEN --folder /CUTnTag/hs/ --output hs_links.txt"
    echo "  IGV_cloud_tracks -igv_session_xml -i hs_links.txt -o igv_session.xml -g hg38"
    echo
}

# Show help if requested or no arguments
if [[ $# -eq 0 || "$1" == "-h" || "$1" == "--help" ]]; then
    show_help
    exit 0
fi

# Parse subcommand
subcommand="$1"
shift

case "$subcommand" in
    -dropbox_URL)
        echo "üöÄ Generating Dropbox URLs..."
        python3 "$script_dir/generate_dropbox_links.py" "$@"
        ;;
    -igv_session_xml)
        echo "üß¨ Generating IGV session XML..."
        python3 "$script_dir/generate_igv_session.py" "$@"
        ;;
    *)
        echo "‚ùå Unknown subcommand: $subcommand"
        echo
        show_help
        exit 1
        ;;
esac
